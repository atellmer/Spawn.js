var Spawn=function(){"use strict";var a={},b={},c={},d={"*":[]},e=function(){function f(a,b){var e,c=a.split("."),d=k(b);for(e=0;e<c.length;e++){if(!d.hasOwnProperty(c[e]))return null;d=d[c[e]]}return d}function g(c){var e;for(e in d)d.hasOwnProperty(e)&&(e===c?i(d[e]):(c.length<e.length&&new RegExp("^\\"+c+".","i").test(e)&&JSON.stringify(f(e,b))!==JSON.stringify(f(e,a))&&i(d[e]),c.length>e.length&&new RegExp("^\\"+e+".","i").test(c)&&i(d[e])));i(d["*"])}function h(){var a;for(a in d)d.hasOwnProperty(a)&&i(d[a])}function i(a){var b;for(b=0;b<a.length;b++)a[b]()}function j(a,b){var c;for(c=0;c<a.length;c++)if(a[c]===b)return!1;return!0}function k(a){return JSON.parse(JSON.stringify(a))}function l(a){var b=Object.prototype.toString.call(a);return"object"==typeof a&&"array"!==b.slice(8,b.length-1).toLowerCase()}var e=this;if(arguments[0]){if(!l(arguments[0]))throw new Error("Spawn: the initial state must be plain object!");a=arguments[0]}Spawn=function(){return e},e.getState=function(){return k(a)},e.select=function(b){if("string"==typeof b)return"*"===b?k(a):f(b,a);if("function"==typeof b)return b(k(a));throw new Error("Spawn: the select method takes only a string or function as argument!")},e.detect=function(b,h){if("string"!=typeof b)throw new Error("Spawn: the detect method takes only a string for first argument!");if("function"!=typeof h)throw new Error("Spawn: the detect method takes only a function for second argument!");return d[b]||(d[b]=[]),"*"===b&&j(d[b],h)?(d[b].push(h),e):j(d[b],h)?(d[b].push(h),f(b,a)&&(c=k(a),g(b)),e):e},e.update=function(d,i){if("string"!=typeof d)throw new Error("Spawn: the update method takes only a string for first argument!");var p,j=d.split("."),m=k(a),n=m;if("*"===d){if(l(i))return a=k(i),b={},c={},h(),e;throw new Error("Spawn: the update method takes only a plain object for replace full state! Check your update('*') method.")}for(p=0;p<j.length;p++){if(m.hasOwnProperty(j[p])||(m[j[p]]={}),p===j.length-1){m[j[p]]=i;break}m=m[j[p]]}return c=k(n),JSON.stringify(f(d,a))!==JSON.stringify(f(d,c))&&(a=k(c),g(d),b=k(c)),e}};return e}();