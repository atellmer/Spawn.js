var Spawn=function(){"use strict";var a={},b={},c={},d={"*":[]},e="@@SPAWN/INIT",f=function(){function g(a,b){var e,c=a.split("."),d=m(b);for(e=0;e<c.length;e++){if(!d.hasOwnProperty(c[e]))return null;d=d[c[e]]}return d}function h(a,b){return JSON.stringify(g(a,b))}function i(a,b,c,d){var e;for(e in b)if(b.hasOwnProperty(e)){if(e===a){k(b[e]);continue}if(a.length<e.length&&new RegExp("^\\"+a+".","i").test(e)&&h(e,d)!==h(e,c)){k(b[e]);continue}if(a.length>e.length&&new RegExp("^\\"+e+".","i").test(a)){k(b[e]);continue}}k(b["*"])}function j(a,b){var c;for(c in a)a.hasOwnProperty(c)&&(b(c),k(a[c]),k(a["*"]))}function k(a){var b;for(b=0;b<a.length;b++)a[b]()}function l(a,b){var c;for(c=0;c<a.length;c++)if(a[c]===b)return!1;return!0}function m(a){return JSON.parse(JSON.stringify(a))}function n(a){return!(!o(a)||p(a))}function o(a){return"object"==typeof a}function p(a){var b=Object.prototype.toString.call(a);return"array"===b.slice(8,b.length-1).toLowerCase()}function q(a){return"function"==typeof a}function r(a){return"string"==typeof a}function s(a){throw new Error(a)}var f=this;arguments[0]&&(n(arguments[0])||s("Spawn: the initial state must be plain object!"),a=arguments[0]),Spawn=function(){return f},f.getState=function(){return m(a)},f.select=function(b){if(r(b))switch(b){case"*":return m(a);case"->":return e;default:return g(b,a)}if(q(b))return b(m(a));throw new Error("Spawn: the select method takes only a string or function as argument!")},f.detect=function(e,h){return r(e)||s("Spawn: the detect method takes only a string for first argument!"),q(h)||s("Spawn: the detect method takes only a function for second argument!"),d[e]||(d[e]=[]),"*"===e&&l(d[e],h)?(d[e].push(h),f):l(d[e],h)?(d[e].push(h),g(e,a)&&(c=m(a),i(e,d,a,b)),f):f},f.update=function(g,l){r(g)||s("Spawn: the update method takes only a string for first argument!");var u,o=g.split("."),p=m(a),q=p;if("*"===g){if(n(l))return a=m(l),b={},c={},j(d,function(a){e=a}),f;s("Spawn: the update method takes only a plain object for replace full state! Check your update('*') method.")}for(e=g,u=0;u<o.length;u++){if(p.hasOwnProperty(o[u])||(p[o[u]]={}),u===o.length-1){p[o[u]]=l;break}p=p[o[u]]}return c=m(q),h(g,a)!==h(g,c)?(a=m(c),i(g,d,a,b),b=m(c)):k(d["*"]),f}};return f}();